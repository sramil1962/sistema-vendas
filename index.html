<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Vendas - Perfumes & Produtos</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #d4af37;
            --primary-dark: #b8941f;
            --secondary: #1a1a2e;
            --accent: #ff6b9d;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --bg-dark: #0f0f1e;
            --bg-card: #16213e;
            --text-light: #e8e8e8;
            --text-muted: #a0a0b0;
            --border: #2a2a3e;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #1a1a3e 100%);
            color: var(--text-light);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--secondary) 0%, #2a2a4e 100%);
            padding: 25px 0;
            border-bottom: 3px solid var(--primary);
            box-shadow: 0 4px 20px rgba(212, 175, 55, 0.2);
            margin-bottom: 30px;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.2em;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary) 0%, #f0d98d 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

        .vendor-selector {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .vendor-btn {
            padding: 10px 20px;
            background: var(--bg-card);
            border: 2px solid var(--border);
            color: var(--text-light);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.95em;
        }

        .vendor-btn:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .vendor-btn.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-color: var(--primary);
            color: var(--secondary);
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            background: var(--bg-card);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .nav-tab {
            padding: 12px 24px;
            background: transparent;
            border: 2px solid var(--border);
            color: var(--text-muted);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.95em;
            flex: 1;
            min-width: 140px;
        }

        .nav-tab:hover {
            border-color: var(--primary);
            color: var(--text-light);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-color: var(--primary);
            color: var(--secondary);
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: var(--primary);
            box-shadow: 0 12px 35px rgba(212, 175, 55, 0.2);
        }

        .card-header {
            font-family: 'Playfair Display', serif;
            font-size: 1.5em;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-light);
            font-size: 0.95em;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            background: var(--bg-dark);
            border: 2px solid var(--border);
            border-radius: 8px;
            color: var(--text-light);
            font-size: 0.95em;
            transition: all 0.3s ease;
            font-family: 'DM Sans', sans-serif;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        /* Buttons */
        .btn {
            padding: 12px 28px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95em;
            transition: all 0.3s ease;
            font-family: 'DM Sans', sans-serif;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--secondary);
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.85em;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-dark);
            border-radius: 8px;
            overflow: hidden;
        }

        thead {
            background: linear-gradient(135deg, var(--secondary) 0%, #2a2a4e 100%);
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 700;
            color: var(--primary);
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        tbody tr:hover {
            background: rgba(212, 175, 55, 0.05);
        }

        tbody tr {
            cursor: pointer;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--bg-card) 0%, #1a1a3e 100%);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.2);
        }

        .stat-label {
            font-size: 0.85em;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-family: 'Playfair Display', serif;
            font-size: 2em;
            font-weight: 900;
            color: var(--primary);
        }

        /* Product Grid */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .product-card {
            background: var(--bg-dark);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .product-card:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.2);
        }

        .product-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #2a2a4e 0%, #1a1a3e 100%);
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            border: 2px solid var(--border);
            overflow: hidden;
            position: relative;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-image .emoji-placeholder {
            font-size: 3em;
        }

        .product-name {
            font-weight: 700;
            font-size: 1.1em;
            margin-bottom: 8px;
            color: var(--text-light);
        }

        .product-price {
            color: var(--primary);
            font-weight: 700;
            font-size: 1.2em;
            margin-bottom: 5px;
        }

        .product-stock {
            font-size: 0.9em;
            color: var(--text-muted);
        }

        .stock-low {
            color: var(--warning);
            font-weight: 600;
        }

        .stock-out {
            color: var(--danger);
            font-weight: 600;
        }

        /* Parcelas */
        .parcela-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg-dark);
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid var(--border);
        }

        .parcela-item.paga {
            opacity: 0.6;
            border-color: var(--success);
        }

        .parcela-item.atrasada {
            border-color: var(--danger);
            background: rgba(220, 53, 69, 0.1);
        }

        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .badge-success {
            background: var(--success);
            color: white;
        }

        .badge-warning {
            background: var(--warning);
            color: var(--secondary);
        }

        .badge-danger {
            background: var(--danger);
            color: white;
        }

        .badge-info {
            background: #17a2b8;
            color: white;
        }

        /* Tabs Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 30px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 2px solid var(--primary);
            box-shadow: 0 20px 60px rgba(212, 175, 55, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }

        .modal-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.8em;
            font-weight: 700;
            color: var(--primary);
        }

        .close-modal {
            background: transparent;
            border: none;
            color: var(--text-light);
            font-size: 2em;
            cursor: pointer;
            line-height: 1;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            background: var(--danger);
            transform: rotate(90deg);
        }

        /* Cliente Card */
        .cliente-card {
            background: var(--bg-dark);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cliente-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.2);
        }

        .cliente-nome {
            font-weight: 700;
            font-size: 1.2em;
            color: var(--text-light);
            margin-bottom: 8px;
        }

        .cliente-info {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            color: var(--text-muted);
            font-size: 0.9em;
        }

        .cliente-stats {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }

        .cliente-stat {
            flex: 1;
        }

        .cliente-stat-label {
            font-size: 0.8em;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .cliente-stat-value {
            font-weight: 700;
            font-size: 1.1em;
            color: var(--primary);
            margin-top: 5px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 {
                font-size: 1.5em;
            }

            .header-content {
                flex-direction: column;
                align-items: flex-start;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .nav-tab {
                width: 100%;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                padding: 20px;
            }
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-success {
            background: rgba(40, 167, 69, 0.2);
            border: 1px solid var(--success);
            color: #4ade80;
        }

        .alert-warning {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid var(--warning);
            color: #fbbf24;
        }

        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-box input {
            padding-left: 45px;
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 1.2em;
        }

        .info-section {
            background: var(--bg-dark);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid var(--primary);
        }

        .info-section h4 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: var(--text-muted);
            font-weight: 600;
        }

        .info-value {
            color: var(--text-light);
            font-weight: 700;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>üíé Perfumes & Produtos</h1>
            <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
                <div id="statusNuvem" style="padding: 8px 16px; background: var(--bg-dark); border-radius: 8px; border: 1px solid var(--border); font-size: 0.85em;">
                    <span id="iconNuvem">üíæ</span> <span id="textoNuvem">Local</span>
                </div>
                <div class="vendor-selector">
                    <span style="color: var(--text-muted); font-weight: 600;">Vendedor:</span>
                    <button class="vendor-btn active" onclick="selectVendor('Voc√™')">Voc√™</button>
                    <button class="vendor-btn" onclick="selectVendor('Esposa')">Esposa</button>
                    <button class="vendor-btn" onclick="selectVendor('Filha')">Filha</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Produtos Cadastrados</div>
                <div class="stat-value" id="totalProdutos">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total em Estoque</div>
                <div class="stat-value" id="totalEstoque">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">üí∞ Capital Empatado</div>
                <div class="stat-value" id="capitalEmpatado" style="font-size: 1.8em;">R$ 0,00</div>
                <div style="font-size: 0.75em; color: var(--text-muted); margin-top: 5px;">Custo do estoque</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">üíµ Valor Potencial</div>
                <div class="stat-value" id="valorPotencial" style="font-size: 1.8em;">R$ 0,00</div>
                <div style="font-size: 0.75em; color: var(--text-muted); margin-top: 5px;">Se vender tudo</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Vendas Hoje</div>
                <div class="stat-value" id="vendasHoje">R$ 0,00</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Lucro do M√™s</div>
                <div class="stat-value" id="lucroMes">R$ 0,00</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Contas a Receber</div>
                <div class="stat-value" id="contasReceber">R$ 0,00</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">üìà Lucro Potencial</div>
                <div class="stat-value" id="lucroPotencial" style="font-size: 1.8em; color: var(--success);">R$ 0,00</div>
                <div style="font-size: 0.75em; color: var(--text-muted); margin-top: 5px;">Se vender tudo</div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('produtos')">üì¶ Produtos</button>
            <button class="nav-tab" onclick="showTab('clientes')">üë• Clientes</button>
            <button class="nav-tab" onclick="showTab('vendas')">üí∞ Vendas</button>
            <button class="nav-tab" onclick="showTab('financeiro')">üìä Financeiro</button>
            <button class="nav-tab" onclick="showTab('contas')">üìÖ Contas a Receber</button>
            <button class="nav-tab" onclick="showTab('catalogo')">üñºÔ∏è Cat√°logo</button>
        </div>

        <!-- Tab: Produtos -->
        <div id="produtos" class="tab-content active">
            <div class="card">
                <div class="card-header">Adicionar Produto</div>
                <form id="formProduto" onsubmit="adicionarProduto(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nome do Produto *</label>
                            <input type="text" id="nomeProduto" required>
                        </div>
                        <div class="form-group">
                            <label>Categoria</label>
                            <select id="categoriaProduto">
                                <option>Perfumes</option>
                                <option>Cosm√©ticos</option>
                                <option>Eletr√¥nicos</option>
                                <option>Roupas</option>
                                <option>Outros</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Descri√ß√£o do Produto</label>
                        <textarea id="descricaoProduto" rows="3" placeholder="Descreva o produto: marca, tamanho, caracter√≠sticas, etc..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Foto do Produto</label>
                        <input type="file" id="fotoProduto" accept="image/*" onchange="previewImagem(event)">
                        <div id="previewFoto" style="margin-top: 15px; display: none;">
                            <img id="imagemPreview" style="max-width: 200px; max-height: 200px; border-radius: 8px; border: 2px solid var(--border);">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Pre√ßo de Custo (R$) *</label>
                            <input type="number" id="precoCusto" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label>Pre√ßo de Venda (R$) *</label>
                            <input type="number" id="precoVenda" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label>Quantidade em Estoque *</label>
                            <input type="number" id="quantidadeEstoque" required>
                        </div>
                        <div class="form-group">
                            <label>Emoji (opcional)</label>
                            <input type="text" id="emojiProduto" placeholder="üå∏">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Adicionar Produto</button>
                </form>
            </div>

            <div class="card">
                <div class="card-header">Lista de Produtos</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Produto</th>
                                <th>Categoria</th>
                                <th>Custo</th>
                                <th>Venda</th>
                                <th>Estoque</th>
                                <th>Margem</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="listaProdutos"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tab: Clientes -->
        <div id="clientes" class="tab-content">
            <div class="card">
                <div class="card-header">Cadastrar Cliente</div>
                <form id="formCliente" onsubmit="cadastrarCliente(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nome Completo *</label>
                            <input type="text" id="nomeClienteCadastro" required>
                        </div>
                        <div class="form-group">
                            <label>Telefone *</label>
                            <input type="tel" id="telefoneCliente" placeholder="(00) 00000-0000" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Endere√ßo Completo *</label>
                        <input type="text" id="enderecoCliente" placeholder="Rua, N√∫mero, Bairro, Cidade" required>
                    </div>
                    <div class="form-group">
                        <label>Observa√ß√µes (opcional)</label>
                        <textarea id="observacoesCliente" rows="3" placeholder="Informa√ß√µes adicionais sobre o cliente..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Cadastrar Cliente</button>
                </form>
            </div>

            <div class="card">
                <div class="card-header">Lista de Clientes</div>
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="searchCliente" placeholder="Buscar cliente por nome, telefone ou endere√ßo..." onkeyup="filtrarClientes()">
                </div>
                <div id="listaClientes"></div>
            </div>
        </div>

        <!-- Tab: Vendas -->
        <div id="vendas" class="tab-content">
            <div class="card">
                <div class="card-header">Registrar Venda</div>
                <form id="formVenda" onsubmit="registrarVenda(event)">
                    <div class="form-group">
                        <label>Cliente *</label>
                        <select id="clienteVenda" required onchange="atualizarInfoCliente()">
                            <option value="">Selecione um cliente</option>
                        </select>
                    </div>
                    
                    <div id="infoClienteVenda" style="display: none;" class="info-section">
                        <h4>üìã Informa√ß√µes do Cliente</h4>
                        <div class="info-row">
                            <span class="info-label">Telefone:</span>
                            <span class="info-value" id="infoTelefone">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Endere√ßo:</span>
                            <span class="info-value" id="infoEndereco">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Total Comprado:</span>
                            <span class="info-value" id="infoTotalComprado">R$ 0,00</span>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Produto *</label>
                            <select id="produtoVenda" required onchange="atualizarPrecoVenda()"></select>
                        </div>
                        <div class="form-group">
                            <label>Quantidade *</label>
                            <input type="number" id="quantidadeVenda" value="1" min="1" required onchange="calcularTotalVenda()">
                        </div>
                        <div class="form-group">
                            <label>Pre√ßo Unit√°rio (R$) *</label>
                            <input type="number" id="precoUnitarioVenda" step="0.01" required onchange="calcularTotalVenda()">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Total (R$)</label>
                            <input type="number" id="totalVenda" step="0.01" readonly style="background: var(--bg-dark); font-weight: 700; color: var(--primary);">
                        </div>
                        <div class="form-group">
                            <label>Forma de Pagamento *</label>
                            <select id="formaPagamento" required onchange="toggleParcelas()">
                                <option value="dinheiro">üíµ Dinheiro</option>
                                <option value="pix">üì± PIX</option>
                                <option value="debito">üí≥ D√©bito</option>
                                <option value="credito">üí≥ Cr√©dito √† Vista</option>
                                <option value="prazo">üìÖ A Prazo</option>
                            </select>
                        </div>
                    </div>
                    <div id="parcelasContainer" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Valor de Entrada (R$)</label>
                                <input type="number" id="valorEntrada" step="0.01" value="0" onchange="calcularRestante()">
                            </div>
                            <div class="form-group">
                                <label>Restante a Parcelar (R$)</label>
                                <input type="number" id="valorRestante" step="0.01" readonly style="background: var(--bg-dark); font-weight: 700; color: var(--warning);">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>N√∫mero de Parcelas *</label>
                                <input type="number" id="numeroParcelas" min="1" value="1" onchange="calcularParcelas()">
                            </div>
                            <div class="form-group">
                                <label>Data Primeira Parcela *</label>
                                <input type="date" id="dataPrimeiraParcela">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Valor por Parcela (R$)</label>
                            <input type="number" id="valorParcela" step="0.01" readonly style="background: var(--bg-dark); font-weight: 700; color: var(--primary);">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Registrar Venda</button>
                </form>
            </div>

            <div class="card">
                <div class="card-header">Hist√≥rico de Vendas</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Data/Hora</th>
                                <th>Cliente</th>
                                <th>Produto</th>
                                <th>Qtd</th>
                                <th>Total</th>
                                <th>Pagamento</th>
                                <th>Vendedor</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="listaVendas"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tab: Financeiro -->
        <div id="financeiro" class="tab-content">
            <div class="card">
                <div class="card-header">Resumo Financeiro</div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Vendas Voc√™</div>
                        <div class="stat-value" id="vendasVoce">R$ 0,00</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Vendas Esposa</div>
                        <div class="stat-value" id="vendasEsposa">R$ 0,00</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Vendas Filha</div>
                        <div class="stat-value" id="vendasFilha">R$ 0,00</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Lucro Total</div>
                        <div class="stat-value" id="lucroTotal">R$ 0,00</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">Adicionar Despesa</div>
                <form id="formDespesa" onsubmit="adicionarDespesa(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Descri√ß√£o *</label>
                            <input type="text" id="descricaoDespesa" required>
                        </div>
                        <div class="form-group">
                            <label>Valor (R$) *</label>
                            <input type="number" id="valorDespesa" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label>Data *</label>
                            <input type="date" id="dataDespesa" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Adicionar Despesa</button>
                </form>
            </div>

            <div class="card">
                <div class="card-header">Despesas</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Descri√ß√£o</th>
                                <th>Valor</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="listaDespesas"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tab: Contas a Receber -->
        <div id="contas" class="tab-content">
            <div class="card">
                <div class="card-header">Contas a Receber</div>
                <div id="listaContasReceber"></div>
            </div>
        </div>

        <!-- Tab: Cat√°logo -->
        <div id="catalogo" class="tab-content">
            <div class="card">
                <div class="card-header">Cat√°logo de Produtos</div>
                <div class="product-grid" id="catalogoProdutos"></div>
            </div>
        </div>
    </div>

    <!-- Modal Detalhes do Cliente -->
    <div id="modalCliente" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalClienteNome"></h2>
                <button class="close-modal" onclick="fecharModal()">&times;</button>
            </div>
            <div id="modalClienteConteudo"></div>
        </div>
    </div>

    <script>
        // Configura√ß√£o do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBxXqJc8vK9mH-YFZNzLx3jQ8pN6rE4tVw",
            authDomain: "sistema-vendas-perfumes.firebaseapp.com",
            databaseURL: "https://sistema-vendas-perfumes-default-rtdb.firebaseio.com",
            projectId: "sistema-vendas-perfumes",
            storageBucket: "sistema-vendas-perfumes.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef123456"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Estado Global
        let vendedorAtual = 'Voc√™';
        let produtos = [];
        let clientes = [];
        let vendas = [];
        let despesas = [];
        let contasReceber = [];
        let imagemProdutoTemp = null;
        let usandoNuvem = false;

        // Verificar se deve usar nuvem
        function verificarModoNuvem() {
            const modoNuvem = localStorage.getItem('usarNuvem');
            return modoNuvem === 'true';
        }

        // Preview de imagem
        function previewImagem(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagemProdutoTemp = e.target.result;
                    document.getElementById('imagemPreview').src = e.target.result;
                    document.getElementById('previewFoto').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        // Carregar dados (Firebase ou localStorage)
        async function carregarDados() {
            usandoNuvem = verificarModoNuvem();
            
            if (usandoNuvem) {
                await carregarDadosNuvem();
            } else {
                carregarDadosLocal();
                verificarMigracao();
            }
            
            atualizarTudo();
        }

        // Carregar dados do localStorage
        function carregarDadosLocal() {
            try {
                const produtosData = localStorage.getItem('perfumes_produtos');
                produtos = produtosData ? JSON.parse(produtosData) : [];
                
                const clientesData = localStorage.getItem('perfumes_clientes');
                clientes = clientesData ? JSON.parse(clientesData) : [];
                
                const vendasData = localStorage.getItem('perfumes_vendas');
                vendas = vendasData ? JSON.parse(vendasData) : [];
                
                const despesasData = localStorage.getItem('perfumes_despesas');
                despesas = despesasData ? JSON.parse(despesasData) : [];
                
                const contasData = localStorage.getItem('perfumes_contasReceber');
                contasReceber = contasData ? JSON.parse(contasData) : [];
                
                console.log('Dados carregados do localStorage:', {
                    produtos: produtos.length,
                    clientes: clientes.length,
                    vendas: vendas.length
                });
            } catch (error) {
                console.error('Erro ao carregar dados locais:', error);
                produtos = [];
                clientes = [];
                vendas = [];
                despesas = [];
                contasReceber = [];
            }
        }

        // Carregar dados da nuvem (Firebase)
        async function carregarDadosNuvem() {
            try {
                console.log('Carregando dados da nuvem...');
                
                const snapshot = await database.ref('/').once('value');
                const dados = snapshot.val();
                
                if (dados) {
                    produtos = dados.produtos || [];
                    clientes = dados.clientes || [];
                    vendas = dados.vendas || [];
                    despesas = dados.despesas || [];
                    contasReceber = dados.contasReceber || [];
                    
                    console.log('Dados carregados da nuvem:', {
                        produtos: produtos.length,
                        clientes: clientes.length,
                        vendas: vendas.length
                    });
                    
                    // Sincroniza√ß√£o em tempo real
                    sincronizarTempoReal();
                } else {
                    console.log('Nenhum dado na nuvem ainda');
                }
            } catch (error) {
                console.error('Erro ao carregar da nuvem:', error);
                mostrarAlerta('Erro ao conectar com a nuvem. Usando dados locais.', 'warning');
                carregarDadosLocal();
            }
        }

        // Sincronizar em tempo real
        function sincronizarTempoReal() {
            database.ref('/produtos').on('value', (snapshot) => {
                const dados = snapshot.val();
                if (dados && JSON.stringify(dados) !== JSON.stringify(produtos)) {
                    produtos = dados;
                    renderizarProdutos();
                    renderizarCatalogo();
                    atualizarEstatisticas();
                }
            });
            
            database.ref('/vendas').on('value', (snapshot) => {
                const dados = snapshot.val();
                if (dados && JSON.stringify(dados) !== JSON.stringify(vendas)) {
                    vendas = dados;
                    renderizarVendas();
                    atualizarEstatisticas();
                }
            });
        }

        // Salvar dados (Firebase ou localStorage)
        async function salvarDados() {
            if (usandoNuvem) {
                await salvarDadosNuvem();
            } else {
                salvarDadosLocal();
            }
        }

        // Salvar dados no localStorage
        function salvarDadosLocal() {
            try {
                localStorage.setItem('perfumes_produtos', JSON.stringify(produtos));
                localStorage.setItem('perfumes_clientes', JSON.stringify(clientes));
                localStorage.setItem('perfumes_vendas', JSON.stringify(vendas));
                localStorage.setItem('perfumes_despesas', JSON.stringify(despesas));
                localStorage.setItem('perfumes_contasReceber', JSON.stringify(contasReceber));
                console.log('Dados salvos no localStorage');
            } catch (error) {
                console.error('Erro ao salvar dados locais:', error);
                mostrarAlerta('Erro ao salvar dados. Tente novamente.', 'warning');
            }
        }

        // Salvar dados na nuvem (Firebase)
        async function salvarDadosNuvem() {
            try {
                await database.ref('/').set({
                    produtos: produtos,
                    clientes: clientes,
                    vendas: vendas,
                    despesas: despesas,
                    contasReceber: contasReceber,
                    ultimaAtualizacao: new Date().toISOString()
                });
                console.log('Dados salvos na nuvem!');
            } catch (error) {
                console.error('Erro ao salvar na nuvem:', error);
                mostrarAlerta('Erro ao salvar na nuvem. Salvando localmente.', 'warning');
                salvarDadosLocal();
            }
        }

        // Verificar se precisa migrar dados
        function verificarMigracao() {
            const temDadosLocais = produtos.length > 0 || clientes.length > 0 || vendas.length > 0;
            const jaMigrou = localStorage.getItem('jaMigrouParaNuvem') === 'true';
            
            if (temDadosLocais && !jaMigrou && !usandoNuvem) {
                setTimeout(() => {
                    if (confirm(`üå•Ô∏è Encontramos ${produtos.length} produtos salvos localmente!\n\nDeseja migrar seus dados para a nuvem?\n\nCom a nuvem, voc√™ e sua fam√≠lia poder√£o acessar de qualquer dispositivo!`)) {
                        migrarParaNuvem();
                    }
                }, 2000);
            }
        }

        // Migrar dados para nuvem
        async function migrarParaNuvem() {
            try {
                mostrarAlerta('Migrando dados para a nuvem... Aguarde!', 'success');
                
                // Salvar na nuvem
                await database.ref('/').set({
                    produtos: produtos,
                    clientes: clientes,
                    vendas: vendas,
                    despesas: despesas,
                    contasReceber: contasReceber,
                    ultimaAtualizacao: new Date().toISOString()
                });
                
                // Marcar como usando nuvem
                localStorage.setItem('usarNuvem', 'true');
                localStorage.setItem('jaMigrouParaNuvem', 'true');
                usandoNuvem = true;
                
                mostrarAlerta(`‚úÖ Migra√ß√£o conclu√≠da! ${produtos.length} produtos na nuvem!`, 'success');
                
                // Recarregar p√°gina para ativar sincroniza√ß√£o
                setTimeout(() => {
                    location.reload();
                }, 2000);
            } catch (error) {
                console.error('Erro na migra√ß√£o:', error);
                mostrarAlerta('Erro ao migrar para nuvem. Tente novamente.', 'warning');
            }
        }

        // Navega√ß√£o
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Atualizar dados ao mudar de aba
            if (tabName === 'clientes') {
                renderizarClientes();
            }
        }

        function selectVendor(vendor) {
            vendedorAtual = vendor;
            document.querySelectorAll('.vendor-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // Clientes
        function cadastrarCliente(e) {
            e.preventDefault();
            
            const cliente = {
                id: Date.now(),
                nome: document.getElementById('nomeClienteCadastro').value,
                telefone: document.getElementById('telefoneCliente').value,
                endereco: document.getElementById('enderecoCliente').value,
                observacoes: document.getElementById('observacoesCliente').value,
                dataCadastro: new Date().toISOString()
            };
            
            clientes.push(cliente);
            salvarDados();
            atualizarTudo();
            
            document.getElementById('formCliente').reset();
            mostrarAlerta('Cliente cadastrado com sucesso!', 'success');
        }

        function renderizarClientes() {
            const container = document.getElementById('listaClientes');
            const selectVenda = document.getElementById('clienteVenda');
            
            container.innerHTML = '';
            selectVenda.innerHTML = '<option value="">Selecione um cliente</option>';
            
            if (clientes.length === 0) {
                container.innerHTML = '<p style="color: var(--text-muted); text-align: center; padding: 40px;">Nenhum cliente cadastrado ainda.</p>';
                return;
            }
            
            clientes.forEach(cliente => {
                // Calcular estat√≠sticas do cliente
                const vendasCliente = vendas.filter(v => v.clienteId === cliente.id);
                const totalCompras = vendasCliente.reduce((sum, v) => sum + v.total, 0);
                const qtdCompras = vendasCliente.length;
                const contasPendentes = contasReceber.filter(c => c.clienteId === cliente.id && !c.paga);
                const totalPendente = contasPendentes.reduce((sum, c) => sum + c.valor, 0);
                
                container.innerHTML += `
                    <div class="cliente-card" onclick="abrirDetalhesCliente(${cliente.id})">
                        <div class="cliente-nome">üë§ ${cliente.nome}</div>
                        <div class="cliente-info">
                            <span>üì± ${cliente.telefone}</span>
                            <span>üìç ${cliente.endereco}</span>
                        </div>
                        <div class="cliente-stats">
                            <div class="cliente-stat">
                                <div class="cliente-stat-label">Total Comprado</div>
                                <div class="cliente-stat-value">R$ ${totalCompras.toFixed(2)}</div>
                            </div>
                            <div class="cliente-stat">
                                <div class="cliente-stat-label">Compras</div>
                                <div class="cliente-stat-value">${qtdCompras}</div>
                            </div>
                            <div class="cliente-stat">
                                <div class="cliente-stat-label">A Receber</div>
                                <div class="cliente-stat-value" style="color: ${totalPendente > 0 ? 'var(--warning)' : 'var(--success)'}">
                                    R$ ${totalPendente.toFixed(2)}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                selectVenda.innerHTML += `<option value="${cliente.id}">${cliente.nome} - ${cliente.telefone}</option>`;
            });
        }

        function filtrarClientes() {
            const busca = document.getElementById('searchCliente').value.toLowerCase();
            const cards = document.querySelectorAll('.cliente-card');
            
            cards.forEach(card => {
                const texto = card.textContent.toLowerCase();
                if (texto.includes(busca)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function abrirDetalhesCliente(clienteId) {
            const cliente = clientes.find(c => c.id === clienteId);
            if (!cliente) return;
            
            const vendasCliente = vendas.filter(v => v.clienteId === clienteId);
            const contasCliente = contasReceber.filter(c => c.clienteId === clienteId);
            const totalCompras = vendasCliente.reduce((sum, v) => sum + v.total, 0);
            const totalPendente = contasCliente.filter(c => !c.paga).reduce((sum, c) => sum + c.valor, 0);
            
            document.getElementById('modalClienteNome').textContent = cliente.nome;
            
            let conteudo = `
                <div class="info-section">
                    <h4>üìã Informa√ß√µes de Contato</h4>
                    <div class="info-row">
                        <span class="info-label">Telefone:</span>
                        <span class="info-value">${cliente.telefone}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Endere√ßo:</span>
                        <span class="info-value">${cliente.endereco}</span>
                    </div>
                    ${cliente.observacoes ? `
                    <div class="info-row">
                        <span class="info-label">Observa√ß√µes:</span>
                        <span class="info-value">${cliente.observacoes}</span>
                    </div>
                    ` : ''}
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                    <div class="stat-card">
                        <div class="stat-label">Total Comprado</div>
                        <div class="stat-value" style="font-size: 1.5em;">R$ ${totalCompras.toFixed(2)}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Compras Realizadas</div>
                        <div class="stat-value" style="font-size: 1.5em;">${vendasCliente.length}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">A Receber</div>
                        <div class="stat-value" style="font-size: 1.5em; color: ${totalPendente > 0 ? 'var(--warning)' : 'var(--success)'}">
                            R$ ${totalPendente.toFixed(2)}
                        </div>
                    </div>
                </div>
            `;
            
            if (vendasCliente.length > 0) {
                conteudo += `
                    <div class="info-section">
                        <h4>üõçÔ∏è Hist√≥rico de Compras</h4>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Data</th>
                                        <th>Produto</th>
                                        <th>Qtd</th>
                                        <th>Total</th>
                                        <th>Pagamento</th>
                                        <th>Vendedor</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${vendasCliente.map(venda => {
                                        const data = new Date(venda.data);
                                        let pagamento = venda.formaPagamento.charAt(0).toUpperCase() + venda.formaPagamento.slice(1);
                                        if (venda.parcelas) pagamento += ` (${venda.parcelas}x)`;
                                        return `
                                            <tr>
                                                <td>${data.toLocaleDateString('pt-BR')}</td>
                                                <td>${venda.produtoNome}</td>
                                                <td>${venda.quantidade}</td>
                                                <td style="color: var(--primary)">R$ ${venda.total.toFixed(2)}</td>
                                                <td>${pagamento}</td>
                                                <td>${venda.vendedor}</td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }
            
            if (contasCliente.length > 0) {
                conteudo += `
                    <div class="info-section" style="margin-top: 20px;">
                        <h4>üí≥ Parcelas</h4>
                        ${contasCliente.map(conta => {
                            const hoje = new Date();
                            const vencimento = new Date(conta.dataVencimento + 'T00:00:00');
                            const atrasada = !conta.paga && vencimento < hoje;
                            const classe = conta.paga ? 'paga' : (atrasada ? 'atrasada' : '');
                            
                            return `
                                <div class="parcela-item ${classe}" style="margin-bottom: 10px;">
                                    <div>
                                        <span style="font-weight: 600;">Parcela ${conta.numeroParcela}/${conta.totalParcelas}</span>
                                        <span style="color: var(--text-muted); margin-left: 15px;">
                                            Venc: ${vencimento.toLocaleDateString('pt-BR')}
                                        </span>
                                        ${atrasada ? '<span class="badge badge-danger" style="margin-left: 10px;">ATRASADA</span>' : ''}
                                        ${conta.paga ? '<span class="badge badge-success" style="margin-left: 10px;">PAGA</span>' : ''}
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 15px;">
                                        <span style="font-weight: 700; color: var(--primary);">R$ ${conta.valor.toFixed(2)}</span>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }
            
            document.getElementById('modalClienteConteudo').innerHTML = conteudo;
            document.getElementById('modalCliente').classList.add('active');
        }

        function fecharModal() {
            document.getElementById('modalCliente').classList.remove('active');
        }

        function atualizarInfoCliente() {
            const clienteId = parseInt(document.getElementById('clienteVenda').value);
            const infoDiv = document.getElementById('infoClienteVenda');
            
            if (!clienteId) {
                infoDiv.style.display = 'none';
                return;
            }
            
            const cliente = clientes.find(c => c.id === clienteId);
            if (!cliente) return;
            
            const vendasCliente = vendas.filter(v => v.clienteId === clienteId);
            const totalCompras = vendasCliente.reduce((sum, v) => sum + v.total, 0);
            
            document.getElementById('infoTelefone').textContent = cliente.telefone;
            document.getElementById('infoEndereco').textContent = cliente.endereco;
            document.getElementById('infoTotalComprado').textContent = `R$ ${totalCompras.toFixed(2)}`;
            
            infoDiv.style.display = 'block';
        }

        // Produtos
        function adicionarProduto(e) {
            e.preventDefault();
            
            const produto = {
                id: Date.now(),
                nome: document.getElementById('nomeProduto').value,
                categoria: document.getElementById('categoriaProduto').value,
                descricao: document.getElementById('descricaoProduto').value,
                foto: imagemProdutoTemp,
                precoCusto: parseFloat(document.getElementById('precoCusto').value),
                precoVenda: parseFloat(document.getElementById('precoVenda').value),
                quantidade: parseInt(document.getElementById('quantidadeEstoque').value),
                emoji: document.getElementById('emojiProduto').value || 'üì¶'
            };
            
            produtos.push(produto);
            salvarDados();
            atualizarTudo();
            
            document.getElementById('formProduto').reset();
            document.getElementById('previewFoto').style.display = 'none';
            imagemProdutoTemp = null;
            mostrarAlerta('Produto adicionado com sucesso!', 'success');
        }

        function removerProduto(id) {
            const senha = prompt('üîí Digite a senha para excluir o produto:');
            
            // Senha padr√£o: 1234 (voc√™ pode mudar depois)
            if (senha === '1234') {
                if (confirm('Deseja realmente remover este produto?')) {
                    produtos = produtos.filter(p => p.id !== id);
                    salvarDados();
                    atualizarTudo();
                    mostrarAlerta('Produto removido com sucesso!', 'success');
                }
            } else if (senha !== null) {
                alert('‚ùå Senha incorreta! Apenas o administrador pode excluir produtos.');
            }
        }

        function renderizarProdutos() {
            const lista = document.getElementById('listaProdutos');
            const select = document.getElementById('produtoVenda');
            
            lista.innerHTML = '';
            select.innerHTML = '<option value="">Selecione um produto</option>';
            
            produtos.forEach(produto => {
                const margem = ((produto.precoVenda - produto.precoCusto) / produto.precoCusto * 100).toFixed(1);
                const stockClass = produto.quantidade === 0 ? 'stock-out' : produto.quantidade < 5 ? 'stock-low' : '';
                
                const descricaoResumida = produto.descricao 
                    ? `<div style="font-size: 0.85em; color: var(--text-muted); margin-top: 5px;">${produto.descricao.substring(0, 50)}${produto.descricao.length > 50 ? '...' : ''}</div>`
                    : '';
                
                lista.innerHTML += `
                    <tr onclick="verDetalhesProduto(${produto.id})" style="cursor: pointer;">
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                ${produto.foto ? `<img src="${produto.foto}" style="width: 40px; height: 40px; object-fit: cover; border-radius: 6px; border: 1px solid var(--border);">` : `<span style="font-size: 1.5em;">${produto.emoji}</span>`}
                                <div>
                                    <strong>${produto.nome}</strong>
                                    ${descricaoResumida}
                                </div>
                            </div>
                        </td>
                        <td>${produto.categoria}</td>
                        <td>R$ ${produto.precoCusto.toFixed(2)}</td>
                        <td>R$ ${produto.precoVenda.toFixed(2)}</td>
                        <td class="${stockClass}">${produto.quantidade}</td>
                        <td style="color: var(--success)">${margem}%</td>
                        <td>
                            <button class="btn btn-danger btn-small" onclick="event.stopPropagation(); removerProduto(${produto.id})">Remover</button>
                        </td>
                    </tr>
                `;
                
                if (produto.quantidade > 0) {
                    select.innerHTML += `<option value="${produto.id}">${produto.emoji} ${produto.nome} (${produto.quantidade} dispon√≠veis)</option>`;
                }
            });
        }

        // Vendas
        function toggleParcelas() {
            const formaPagamento = document.getElementById('formaPagamento').value;
            const container = document.getElementById('parcelasContainer');
            
            if (formaPagamento === 'prazo') {
                container.style.display = 'block';
                document.getElementById('numeroParcelas').required = true;
                document.getElementById('dataPrimeiraParcela').required = true;
                
                const hoje = new Date().toISOString().split('T')[0];
                document.getElementById('dataPrimeiraParcela').value = hoje;
                
                calcularParcelas();
            } else {
                container.style.display = 'none';
                document.getElementById('numeroParcelas').required = false;
                document.getElementById('dataPrimeiraParcela').required = false;
            }
        }

        function atualizarPrecoVenda() {
            const produtoId = parseInt(document.getElementById('produtoVenda').value);
            const produto = produtos.find(p => p.id === produtoId);
            
            if (produto) {
                document.getElementById('precoUnitarioVenda').value = produto.precoVenda.toFixed(2);
                calcularTotalVenda();
            }
        }

        function calcularTotalVenda() {
            const quantidade = parseInt(document.getElementById('quantidadeVenda').value) || 0;
            const precoUnitario = parseFloat(document.getElementById('precoUnitarioVenda').value) || 0;
            const total = quantidade * precoUnitario;
            
            document.getElementById('totalVenda').value = total.toFixed(2);
            
            if (document.getElementById('formaPagamento').value === 'prazo') {
                calcularParcelas();
            }
        }

        function calcularParcelas() {
            const total = parseFloat(document.getElementById('totalVenda').value) || 0;
            const entrada = parseFloat(document.getElementById('valorEntrada').value) || 0;
            const restante = total - entrada;
            const numParcelas = parseInt(document.getElementById('numeroParcelas').value) || 1;
            const valorParcela = restante / numParcelas;
            
            document.getElementById('valorRestante').value = restante.toFixed(2);
            document.getElementById('valorParcela').value = valorParcela.toFixed(2);
        }

        function calcularRestante() {
            calcularParcelas();
        }

        function registrarVenda(e) {
            e.preventDefault();
            
            const clienteId = parseInt(document.getElementById('clienteVenda').value);
            const produtoId = parseInt(document.getElementById('produtoVenda').value);
            const produto = produtos.find(p => p.id === produtoId);
            const cliente = clientes.find(c => c.id === clienteId);
            const quantidade = parseInt(document.getElementById('quantidadeVenda').value);
            
            if (!cliente) {
                alert('Selecione um cliente v√°lido!');
                return;
            }
            
            if (!produto) {
                alert('Selecione um produto v√°lido!');
                return;
            }
            
            if (quantidade > produto.quantidade) {
                alert('Quantidade insuficiente em estoque!');
                return;
            }
            
            const total = parseFloat(document.getElementById('totalVenda').value);
            const formaPagamento = document.getElementById('formaPagamento').value;
            
            const venda = {
                id: Date.now(),
                clienteId: clienteId,
                clienteNome: cliente.nome,
                produtoId: produtoId,
                produtoNome: produto.nome,
                quantidade: quantidade,
                precoUnitario: parseFloat(document.getElementById('precoUnitarioVenda').value),
                total: total,
                precoCusto: produto.precoCusto,
                formaPagamento: formaPagamento,
                vendedor: vendedorAtual,
                data: new Date().toISOString()
            };
            
            // Se for a prazo, criar contas a receber
            if (formaPagamento === 'prazo') {
                const entrada = parseFloat(document.getElementById('valorEntrada').value) || 0;
                const restante = parseFloat(document.getElementById('valorRestante').value);
                const numParcelas = parseInt(document.getElementById('numeroParcelas').value);
                const valorParcela = parseFloat(document.getElementById('valorParcela').value);
                const dataPrimeira = new Date(document.getElementById('dataPrimeiraParcela').value);
                
                venda.entrada = entrada;
                venda.restante = restante;
                venda.parcelas = numParcelas;
                
                // Criar parcelas
                for (let i = 0; i < numParcelas; i++) {
                    const dataVencimento = new Date(dataPrimeira);
                    dataVencimento.setMonth(dataVencimento.getMonth() + i);
                    
                    contasReceber.push({
                        id: Date.now() + i,
                        vendaId: venda.id,
                        clienteId: clienteId,
                        clienteNome: cliente.nome,
                        produto: produto.nome,
                        numeroParcela: i + 1,
                        totalParcelas: numParcelas,
                        valor: valorParcela,
                        dataVencimento: dataVencimento.toISOString().split('T')[0],
                        paga: false,
                        vendedor: vendedorAtual
                    });
                }
            }
            
            // Atualizar estoque
            produto.quantidade -= quantidade;
            
            vendas.push(venda);
            salvarDados();
            atualizarTudo();
            
            document.getElementById('formVenda').reset();
            document.getElementById('parcelasContainer').style.display = 'none';
            document.getElementById('infoClienteVenda').style.display = 'none';
            mostrarAlerta('Venda registrada com sucesso!', 'success');
        }

        function renderizarVendas() {
            const lista = document.getElementById('listaVendas');
            lista.innerHTML = '';
            
            const vendasOrdenadas = [...vendas].reverse();
            
            vendasOrdenadas.forEach(venda => {
                const data = new Date(venda.data);
                const dataFormatada = data.toLocaleDateString('pt-BR') + ' ' + data.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                
                let pagamento = venda.formaPagamento.charAt(0).toUpperCase() + venda.formaPagamento.slice(1);
                if (venda.parcelas) {
                    pagamento += ` (${venda.parcelas}x)`;
                    if (venda.entrada && venda.entrada > 0) {
                        pagamento += `<br><small style="color: var(--success);">Entrada: R$ ${venda.entrada.toFixed(2)}</small>`;
                    }
                }
                
                lista.innerHTML += `
                    <tr onclick="abrirDetalhesCliente(${venda.clienteId})">
                        <td>${dataFormatada}</td>
                        <td><strong>${venda.clienteNome}</strong></td>
                        <td>${venda.produtoNome}</td>
                        <td>${venda.quantidade}</td>
                        <td style="color: var(--primary); font-weight: 700;">R$ ${venda.total.toFixed(2)}</td>
                        <td>${pagamento}</td>
                        <td>${venda.vendedor}</td>
                        <td><span class="badge badge-info">Ver Cliente</span></td>
                    </tr>
                `;
            });
        }

        // Financeiro
        function adicionarDespesa(e) {
            e.preventDefault();
            
            const despesa = {
                id: Date.now(),
                descricao: document.getElementById('descricaoDespesa').value,
                valor: parseFloat(document.getElementById('valorDespesa').value),
                data: document.getElementById('dataDespesa').value
            };
            
            despesas.push(despesa);
            salvarDados();
            atualizarTudo();
            
            document.getElementById('formDespesa').reset();
            mostrarAlerta('Despesa adicionada!', 'success');
        }

        function removerDespesa(id) {
            if (confirm('Deseja remover esta despesa?')) {
                despesas = despesas.filter(d => d.id !== id);
                salvarDados();
                atualizarTudo();
            }
        }

        function renderizarDespesas() {
            const lista = document.getElementById('listaDespesas');
            lista.innerHTML = '';
            
            despesas.forEach(despesa => {
                const data = new Date(despesa.data + 'T00:00:00');
                const dataFormatada = data.toLocaleDateString('pt-BR');
                
                lista.innerHTML += `
                    <tr>
                        <td>${dataFormatada}</td>
                        <td>${despesa.descricao}</td>
                        <td style="color: var(--danger); font-weight: 700;">R$ ${despesa.valor.toFixed(2)}</td>
                        <td>
                            <button class="btn btn-danger btn-small" onclick="removerDespesa(${despesa.id})">Remover</button>
                        </td>
                    </tr>
                `;
            });
        }

        // Contas a Receber
        function marcarParcela(id) {
            const parcela = contasReceber.find(c => c.id === id);
            if (parcela) {
                parcela.paga = !parcela.paga;
                if (parcela.paga) {
                    parcela.dataPagamento = new Date().toISOString().split('T')[0];
                }
                salvarDados();
                atualizarTudo();
            }
        }

        function renderizarContasReceber() {
            const container = document.getElementById('listaContasReceber');
            container.innerHTML = '';
            
            if (contasReceber.length === 0) {
                container.innerHTML = '<p style="color: var(--text-muted); text-align: center; padding: 40px;">Nenhuma conta a receber no momento.</p>';
                return;
            }
            
            // Agrupar por venda
            const vendasAgrupadas = {};
            contasReceber.forEach(conta => {
                if (!vendasAgrupadas[conta.vendaId]) {
                    vendasAgrupadas[conta.vendaId] = [];
                }
                vendasAgrupadas[conta.vendaId].push(conta);
            });
            
            Object.values(vendasAgrupadas).forEach(parcelas => {
                const primeira = parcelas[0];
                const totalPago = parcelas.filter(p => p.paga).reduce((sum, p) => sum + p.valor, 0);
                const totalGeral = parcelas.reduce((sum, p) => sum + p.valor, 0);
                
                container.innerHTML += `
                    <div style="background: var(--bg-dark); padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid var(--border);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                            <div style="cursor: pointer;" onclick="abrirDetalhesCliente(${primeira.clienteId})">
                                <h3 style="color: var(--text-light); margin-bottom: 5px;">üë§ ${primeira.clienteNome}</h3>
                                <p style="color: var(--text-muted); font-size: 0.9em;">${primeira.produto} - ${primeira.vendedor}</p>
                            </div>
                            <div style="text-align: right;">
                                <div style="color: var(--primary); font-weight: 700; font-size: 1.2em;">R$ ${totalGeral.toFixed(2)}</div>
                                <div style="color: var(--success); font-size: 0.9em;">Pago: R$ ${totalPago.toFixed(2)}</div>
                            </div>
                        </div>
                        ${parcelas.map(parcela => {
                            const hoje = new Date();
                            const vencimento = new Date(parcela.dataVencimento + 'T00:00:00');
                            const atrasada = !parcela.paga && vencimento < hoje;
                            const classe = parcela.paga ? 'paga' : (atrasada ? 'atrasada' : '');
                            
                            return `
                                <div class="parcela-item ${classe}">
                                    <div>
                                        <span style="font-weight: 600;">Parcela ${parcela.numeroParcela}/${parcela.totalParcelas}</span>
                                        <span style="color: var(--text-muted); margin-left: 15px;">Venc: ${new Date(parcela.dataVencimento + 'T00:00:00').toLocaleDateString('pt-BR')}</span>
                                        ${atrasada ? '<span class="badge badge-danger" style="margin-left: 10px;">ATRASADA</span>' : ''}
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 15px;">
                                        <span style="font-weight: 700; color: var(--primary);">R$ ${parcela.valor.toFixed(2)}</span>
                                        <button class="btn ${parcela.paga ? 'btn-success' : 'btn-primary'} btn-small" onclick="marcarParcela(${parcela.id})">
                                            ${parcela.paga ? '‚úì Paga' : 'Marcar Paga'}
                                        </button>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            });
        }

        // Cat√°logo
        function renderizarCatalogo() {
            const catalogo = document.getElementById('catalogoProdutos');
            catalogo.innerHTML = '';
            
            if (produtos.length === 0) {
                catalogo.innerHTML = '<p style="color: var(--text-muted); text-align: center; padding: 40px; grid-column: 1/-1;">Nenhum produto cadastrado ainda.</p>';
                return;
            }
            
            produtos.forEach(produto => {
                const stockClass = produto.quantidade === 0 ? 'stock-out' : produto.quantidade < 5 ? 'stock-low' : '';
                const stockText = produto.quantidade === 0 ? 'ESGOTADO' : produto.quantidade < 5 ? `Apenas ${produto.quantidade} unidades` : `${produto.quantidade} em estoque`;
                
                const imagemHtml = produto.foto 
                    ? `<img src="${produto.foto}" alt="${produto.nome}">`
                    : `<span class="emoji-placeholder">${produto.emoji}</span>`;
                
                catalogo.innerHTML += `
                    <div class="product-card" onclick="verDetalhesProduto(${produto.id})" style="cursor: pointer;">
                        <div class="product-image">${imagemHtml}</div>
                        <div class="product-name">${produto.nome}</div>
                        ${produto.descricao ? `<div style="color: var(--text-muted); font-size: 0.85em; margin: 8px 0; line-height: 1.4;">${produto.descricao.substring(0, 80)}${produto.descricao.length > 80 ? '...' : ''}</div>` : ''}
                        <div class="product-price">R$ ${produto.precoVenda.toFixed(2)}</div>
                        <div class="product-stock ${stockClass}">${stockText}</div>
                        <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border); font-size: 0.85em; color: var(--text-muted);">
                            ${produto.categoria}
                        </div>
                    </div>
                `;
            });
        }

        function verDetalhesProduto(produtoId) {
            const produto = produtos.find(p => p.id === produtoId);
            if (!produto) return;
            
            const imagemHtml = produto.foto 
                ? `<img src="${produto.foto}" alt="${produto.nome}" style="max-width: 100%; border-radius: 8px; margin-bottom: 20px;">`
                : `<div style="font-size: 5em; text-align: center; margin: 20px 0;">${produto.emoji}</div>`;
            
            const margem = ((produto.precoVenda - produto.precoCusto) / produto.precoCusto * 100).toFixed(1);
            
            document.getElementById('modalClienteNome').textContent = produto.nome;
            document.getElementById('modalClienteConteudo').innerHTML = `
                ${imagemHtml}
                
                ${produto.descricao ? `
                <div class="info-section">
                    <h4>üìù Descri√ß√£o</h4>
                    <p style="color: var(--text-light); line-height: 1.6;">${produto.descricao}</p>
                </div>
                ` : ''}
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                    <div class="stat-card">
                        <div class="stat-label">Categoria</div>
                        <div class="stat-value" style="font-size: 1.2em;">${produto.categoria}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Pre√ßo de Venda</div>
                        <div class="stat-value" style="font-size: 1.5em;">R$ ${produto.precoVenda.toFixed(2)}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Em Estoque</div>
                        <div class="stat-value" style="font-size: 1.5em;">${produto.quantidade}</div>
                    </div>
                </div>
                
                <div class="info-section">
                    <h4>üí∞ Informa√ß√µes Financeiras</h4>
                    <div class="info-row">
                        <span class="info-label">Pre√ßo de Custo:</span>
                        <span class="info-value">R$ ${produto.precoCusto.toFixed(2)}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Pre√ßo de Venda:</span>
                        <span class="info-value">R$ ${produto.precoVenda.toFixed(2)}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Margem de Lucro:</span>
                        <span class="info-value" style="color: var(--success);">${margem}%</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Lucro por Unidade:</span>
                        <span class="info-value" style="color: var(--success);">R$ ${(produto.precoVenda - produto.precoCusto).toFixed(2)}</span>
                    </div>
                </div>
            `;
            document.getElementById('modalCliente').classList.add('active');
        }

        // Estat√≠sticas
        function atualizarEstatisticas() {
            // Total de produtos cadastrados
            document.getElementById('totalProdutos').textContent = produtos.length;
            
            // Total de unidades em estoque
            const totalEstoque = produtos.reduce((sum, p) => sum + p.quantidade, 0);
            document.getElementById('totalEstoque').textContent = totalEstoque;
            
            // Capital empatado (custo total do estoque)
            const capitalEmpatado = produtos.reduce((sum, p) => sum + (p.precoCusto * p.quantidade), 0);
            document.getElementById('capitalEmpatado').textContent = `R$ ${capitalEmpatado.toFixed(2)}`;
            
            // Valor potencial de venda (se vender tudo)
            const valorPotencial = produtos.reduce((sum, p) => sum + (p.precoVenda * p.quantidade), 0);
            document.getElementById('valorPotencial').textContent = `R$ ${valorPotencial.toFixed(2)}`;
            
            // Lucro potencial (diferen√ßa entre venda e custo)
            const lucroPotencial = valorPotencial - capitalEmpatado;
            document.getElementById('lucroPotencial').textContent = `R$ ${lucroPotencial.toFixed(2)}`;
            
            // Vendas hoje
            const hoje = new Date().toISOString().split('T')[0];
            const vendasHoje = vendas.filter(v => v.data.startsWith(hoje)).reduce((sum, v) => sum + v.total, 0);
            document.getElementById('vendasHoje').textContent = `R$ ${vendasHoje.toFixed(2)}`;
            
            // Lucro do m√™s
            const mesAtual = new Date().getMonth();
            const anoAtual = new Date().getFullYear();
            const vendasMes = vendas.filter(v => {
                const dataVenda = new Date(v.data);
                return dataVenda.getMonth() === mesAtual && dataVenda.getFullYear() === anoAtual;
            });
            
            const receitaMes = vendasMes.reduce((sum, v) => sum + v.total, 0);
            const custoMes = vendasMes.reduce((sum, v) => sum + (v.precoCusto * v.quantidade), 0);
            const despesasMes = despesas.filter(d => {
                const dataDespesa = new Date(d.data + 'T00:00:00');
                return dataDespesa.getMonth() === mesAtual && dataDespesa.getFullYear() === anoAtual;
            }).reduce((sum, d) => sum + d.valor, 0);
            
            const lucroMes = receitaMes - custoMes - despesasMes;
            document.getElementById('lucroMes').textContent = `R$ ${lucroMes.toFixed(2)}`;
            
            // Contas a receber
            const totalReceber = contasReceber.filter(c => !c.paga).reduce((sum, c) => sum + c.valor, 0);
            document.getElementById('contasReceber').textContent = `R$ ${totalReceber.toFixed(2)}`;
            
            // Vendas por vendedor
            const vendasPorVendedor = {
                'Voc√™': 0,
                'Esposa': 0,
                'Filha': 0
            };
            
            vendas.forEach(v => {
                if (vendasPorVendedor[v.vendedor] !== undefined) {
                    vendasPorVendedor[v.vendedor] += v.total;
                }
            });
            
            document.getElementById('vendasVoce').textContent = `R$ ${vendasPorVendedor['Voc√™'].toFixed(2)}`;
            document.getElementById('vendasEsposa').textContent = `R$ ${vendasPorVendedor['Esposa'].toFixed(2)}`;
            document.getElementById('vendasFilha').textContent = `R$ ${vendasPorVendedor['Filha'].toFixed(2)}`;
            
            // Lucro total
            const receitaTotal = vendas.reduce((sum, v) => sum + v.total, 0);
            const custoTotal = vendas.reduce((sum, v) => sum + (v.precoCusto * v.quantidade), 0);
            const despesasTotal = despesas.reduce((sum, d) => sum + d.valor, 0);
            const lucroTotal = receitaTotal - custoTotal - despesasTotal;
            document.getElementById('lucroTotal').textContent = `R$ ${lucroTotal.toFixed(2)}`;
        }

        // Atualizar tudo
        function atualizarTudo() {
            renderizarProdutos();
            renderizarClientes();
            renderizarVendas();
            renderizarDespesas();
            renderizarContasReceber();
            renderizarCatalogo();
            atualizarEstatisticas();
            atualizarStatusNuvem();
        }

        // Atualizar status da nuvem na interface
        function atualizarStatusNuvem() {
            const iconNuvem = document.getElementById('iconNuvem');
            const textoNuvem = document.getElementById('textoNuvem');
            const statusNuvem = document.getElementById('statusNuvem');
            
            if (usandoNuvem) {
                iconNuvem.textContent = '‚òÅÔ∏è';
                textoNuvem.textContent = 'Nuvem Ativa';
                statusNuvem.style.borderColor = 'var(--success)';
                statusNuvem.style.background = 'rgba(40, 167, 69, 0.1)';
            } else {
                iconNuvem.textContent = 'üíæ';
                textoNuvem.textContent = 'Modo Local';
                statusNuvem.style.borderColor = 'var(--border)';
                statusNuvem.style.background = 'var(--bg-dark)';
            }
        }

        // Alertas
        function mostrarAlerta(mensagem, tipo) {
            const alertaExistente = document.querySelector('.alert');
            if (alertaExistente) {
                alertaExistente.remove();
            }
            
            const alerta = document.createElement('div');
            alerta.className = `alert alert-${tipo}`;
            alerta.textContent = mensagem;
            alerta.style.position = 'fixed';
            alerta.style.top = '20px';
            alerta.style.right = '20px';
            alerta.style.zIndex = '10000';
            alerta.style.animation = 'fadeIn 0.3s ease';
            
            document.body.appendChild(alerta);
            
            setTimeout(() => {
                alerta.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => alerta.remove(), 300);
            }, 3000);
        }

        // Fechar modal ao clicar fora
        document.getElementById('modalCliente').addEventListener('click', function(e) {
            if (e.target === this) {
                fecharModal();
            }
        });

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            carregarDados();
        });
    </script>
</body>
</html>
